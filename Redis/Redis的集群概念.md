# 集群(cluster)  
将多个主从结构连接在一起，统一的进行管理，对外提供更强大的存储空间和访问带宽。  
## 集群的作用  
1、分散单台服务器的存储压力，实现可扩展性  
2、分散单台服务器的访问压力，实现负载均衡  
3、降低单台服务器宕机带来的业务灾难(进行主从切换)  
## 集群的结构设计  
### 数据存储设计(可扩展性问题)  
1、当要对一个key进行操作时，先通过循环冗余校验CRC算法得到一个数值，再与16384进行求余操作，得到的结果值就是该key在集群中某个服务器的保存位置，如下图所示：  
![result](https://static01.imgkr.com/temp/ea7bc4082de44629ae98733d19c8031f.png)  
2、将整个集群的存储空间划分成16384份（16384个槽），每台Redis服务器保存一部分。注意：每份代表的是一个存储空间，不是一个key的存储空间，每个槽可存储多个key。  
3、Redis增强可扩展性的方式：新增一个服务器节点之后，原有的节点会将自己的槽分一部分给新节点，如下图所示：  
![result](https://static01.imgkr.com/temp/cc343861246b469c8ed4c0f6b571f6d0.png)  
### 集群内部数据的访问问题(数据命中问题)  
1、每个节点(Redis的存储空间)互相通信，每个节点都保存所有槽的编号信息，比如下图所示，有ABC四个节点。  
![result](https://static01.imgkr.com/temp/e1b82ddd2cf34ac9977672eb8320d4c9.png)  
2、数据的一次命中与二次命中(查找一个数据，如果存在，最多两次命中即可找到)  
(1)一次命中:如果用户访问A节点，且访问的是1-10范围内的数据，则可以直接在A中查询到结果，直接返回。  
(2)二次命中: 用户访问A节点，但访问的数据是11-20范围内的，则通过A可以得知B的具体位置，从B节点中获取数据后返回。   
###  服务器集群结构的搭建  
1、Redis服务器想要成为集群节点，需要在redis.conf配置文件中修改，常见的配置参数如下：  
![result](https://static01.imgkr.com/temp/4e3f8d60085440a18214563056f04c88.png)  
2、查看集群的节点信息(cluster nodes)  
3、集群操作指令  
(1):创建集群  
![result](https://static01.imgkr.com/temp/406ee1d1865a4ace8826ec0c02834628.png)  
1、最后的参数 --cluster-replicas n 表示一个master对应n个slave。
2、master与slave的匹配顺序为第一个master与前n个slave分为一组，形成主从结构。
(2):其他指令  
![result](https://static01.imgkr.com/temp/86e87e9a3ec14c7894510dd06f2bb72d.png)  
### Redis的哨兵模式和Redis Cluster集群的区别  
Redis的哨兵模式：
1、提供恢复功能，即当master出现宕机，会立即从slave中选出一个master。  
2、提供负载均衡，master提供客户端的写操作，其余slave提供读操作    
缺点：无法扩容，受限于单台服务器的性能
Redis的cluster集群：  
1、解决了Redis哨兵模式无法扩容的问题，会部署多个redis哨兵模式节点。  
2、会根据数据key值写入对应的节点，读写都是按值去对应节点读写的（各个节点的数据都是服务的一部分）  
缺点：每个节点的slave都是冷备，即不提供读能力，只有在成为master才有读写能力；  


